/***
	@name: zepto.form
	@author: xiongxiong109
	@description: 基于zepto的表单插件，包括表单验证、发送验证码、验证码倒计时等
	@version: 1.2.0
	@time: 2016-06-03
***/(function(b){b.fn.getCode=function(a){function c(){var c=a.validReg.test(f.val());window.localStorage.getItem(a.countTag)||(c?b.unlockBtn(e,a.defaultTxt):b.lockBtn(e,a.defaultTxt))}function k(){function f(){var d=(new Date).getTime(),d=a.countTime-Math.floor((d-g)/1E3);0>=d?(window.localStorage.removeItem(a.countTag),b.unlockBtn(e,a.defaultTxt),c()):e.val([a.insertStr,d,a.appendStr].join(""))}var g=window.localStorage.getItem(a.countTag);clearInterval(d);f();d=setInterval(f,1E3)}a=b.extend({countTime:180,countTag:"countTime",bind:"#mobile",validReg:/(.*)+/,defaultTxt:"\u83b7\u53d6\u9a8c\u8bc1\u7801",needRefresh:!1,debounce:100,touch:!0,insertStr:"\u7b49\u5f85",appendStr:"\u79d2\u540e,\u518d\u6b21\u83b7\u53d6",sendCode:function(){}},a||{});var f=b(a.bind),e=b(this),d=null;b.lockBtn(e,a.defaultTxt);a.needRefresh?window.localStorage.removeItem(a.countTag):k();var g=b.debounce(c,a.debounce);c();f.on("input",g);e.on(a.touch?"tap":"click",function(){b(this).is(":disabled")||(window.localStorage.setItem(a.countTag,(new Date).getTime()),b.lockBtn(e,[a.insertStr,a.countTime,a.appendStr].join("")),k(),a.sendCode.call(e,f.val()))})}})(Zepto);$.lockBtn=function(b,a){var c=$(b);c.attr("disabled","disabled");c.addClass("disabled");$.isBtn(c)?c.text(a):c.val(a)};$.unlockBtn=function(b,a){var c=$(b);c.removeAttr("disabled");c.removeClass("disabled");$.isBtn(c)?c.text(a):c.val(a)};$.isBtn=function(b){if(0==b.length)return!1;b=$(b)[0].nodeName;return"BUTTON"===b||"A"===b?!0:!1};$.debounce=function(b,a){var c=null;return function(){clearTimeout(c);c=setTimeout(b,a)}};(function(b){b.fn.validate=function(a){function c(a){a.preventDefault()}function k(c){c=c.serializeArray();var d={};b.each(c,function(a,b){d[b.name]=b.value});a.validSuccess.call(e,d)}a=b.extend({validConf:{},touch:!0,submitBtn:null,loadingTxt:"\u6b63\u5728\u63d0\u4ea4",defaultTxt:"\u63d0\u4ea4",validSuccess:function(a){},alertFn:window.alert},a||{});var f=b(this);if("FORM"!==f[0].nodeName)throw Error("the element must be a form");var e=a.submitBtn;null==a.submitBtn&&(e=f.find('[type\x3d"submit"]'));(function(){b.unlockBtn(e,a.defaultTxt);if(a.touch)e.on("click",c).on("tap",function(){b(this).is(":disabled")||f.trigger("submit")});f.on("submit",function(d){c(d);a:{d=f.serializeArray();for(var g=0;g<d.length;g++){var h=a.validConf[d[g].name],l=d[g].value;if(h)if(""===l){if(!1!==h.required){a.alertFn.call(null,h.required);d=!1;break a}}else if(h.reg&&!h.reg.exp.test(l)){a.alertFn.call(null,h.reg.msg);d=!1;break a}}d=!0}d&&(b.lockBtn(e,a.loadingTxt),k(f))})})()}})(Zepto);