@model HappyZu.CloudStore.Web.Areas.Admin.Models.DashboardViewModel
@{
    ViewBag.Title = "控制面板";
}
<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="index.html">商城首页</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <span>控制面板</span>
        </li>
    </ul>
    <div class="page-toolbar">
       
    </div>
</div>
<!-- END PAGE BAR -->
<!-- BEGIN PAGE TITLE-->
<h3 class="page-title">
    控制面板
    <small>仪表盘 & 统计数据</small>
</h3>
<!-- END PAGE TITLE-->
<!-- END PAGE HEADER-->
<div class="row">
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <div class="dashboard-stat blue">
            <div class="visual">
                <i class="fa fa-bar-chart-o"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@Model.SalesStatisticsByDay.Subtotal">0</span>
                </div>
                <div class="desc"> 今日销售总额 </div>
            </div>
            <a class="more" href="javascript:;">
                查看更多
                <i class="m-icon-swapright m-icon-white"></i>
            </a>
        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <div class="dashboard-stat red">
            <div class="visual">
                <i class="fa fa-shopping-cart"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@Model.SalesStatisticsByDay.Orders">0</span>
                </div>
                <div class="desc"> 今日成交订单 </div>
            </div>
            <a class="more" href="javascript:;">
                查看更多
                <i class="m-icon-swapright m-icon-white"></i>
            </a>
        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <div class="dashboard-stat green">
            <div class="visual">
                <i class="fa fa-globe"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@Model.SalesStatisticsByDay.AgentOrders">0</span>
                </div>
                <div class="desc"> 代理商推荐订单 </div>
            </div>
            <a class="more" href="javascript:;">
                查看更多
                <i class="m-icon-swapright m-icon-white"></i>
            </a>
        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <div class="dashboard-stat purple">
            <div class="visual">
                <i class="fa fa-users"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@Model.UserStatisticsByDay.Increase">0</span>
                </div>
                <div class="desc"> 新增会员 </div>
            </div>
            <a class="more" href="javascript:;">
                查看更多
                <i class="m-icon-swapright m-icon-white"></i>
            </a>
        </div>
    </div>
</div>
<div class="clearfix"></div><!-- END DASHBOARD STATS 1-->
<div class="row">
    <div class="col-md-6 col-sm-6">
        <!-- BEGIN PORTLET-->
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-bar-chart font-green"></i>
                    <span class="caption-subject font-green bold uppercase">订单量</span>
                    <span class="caption-helper">月统计</span>
                </div>
                <div class="actions">
                </div>
            </div>
            <div class="portlet-body">
                <div id="site_statistics_loading">
                    <img src="~/Areas/Admin/content/global/img/loading.gif" alt="loading" />
                </div>
                <div id="site_statistics_content" class="display-none">
                    <div id="site_statistics" class="chart"> </div>
                </div>
            </div>
        </div>
        <!-- END PORTLET-->
    </div>
    <div class="col-md-6 col-sm-6">
        <!-- BEGIN PORTLET-->
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-share font-red-sunglo hide"></i>
                    <span class="caption-subject font-red-sunglo bold uppercase">销售额</span>
                    <span class="caption-helper">月统计</span>
                </div>
                <div class="actions">
                </div>
            </div>
            <div class="portlet-body">
                <div id="sale_statistics_loading">
                    <img src="~/Areas/Admin/content/global/img/loading.gif" alt="loading" />
                </div>
                <div id="sale_statistics_content" class="display-none">
                    <div id="sale_statistics" style="height: 300px;"> </div>
                </div>
            </div>
        </div>
        <!-- END PORTLET-->
    </div>
</div>
<!-- BEGIN DASHBOARD STATS 1-->
@section scripts
{
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <script src="~/Areas/Admin/content/global/plugins/moment.min.js" type="text/javascript"></script>
<script src="~/Areas/Admin/content/global/plugins/counterup/jquery.waypoints.min.js" type="text/javascript"></script>
    <script src="~/Areas/Admin/content/global/plugins/counterup/jquery.counterup.min.js" type="text/javascript"></script>
    <script src="~/Areas/Admin/content/global/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
    <script src="~/Areas/Admin/content/global/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
    <script src="~/Areas/Admin/content/global/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN PAGE LEVEL SCRIPTS -->
    <script>

        $(function() {
            var urlOrdersLine =
                "@Url.Action("GetDashboardOrderStatistics", "Dashboard", new {area = "Admin", count = 10})";
            $.getJSON(urlOrdersLine,
                {},
                function(data) {
                    if (data.success) {
                        var ordersLine = [];
                        var amountsLine = [];
                        for (var i in data.result.orders) {
                            if (data.result.orders.hasOwnProperty(i)) {
                                var obj = [i, data.result.orders[i]];
                                ordersLine.push(obj);
                            }
                        }
                        for (var j in data.result.amounts) {
                            var aobj = [j, data.result.amounts[j]];
                            amountsLine.push(aobj);
                        }
                        loadOrdersLine(ordersLine);
                        loadSalesLine(amountsLine);
                    }
                    //var ordersLine = [];
                    //for (var i in data) {
                    //    var obj = [i, data[i]];
                    //    ordersLine.push(obj);
                    //}

                    //loadOrdersLine(ordersLine);
                });
        });

        

        function loadOrdersLine(ordersLine) {

            if ($('#site_statistics').size() != 0) {

                $('#site_statistics_loading').hide();
                $('#site_statistics_content').show();

                var plot_statistics = $.plot($("#site_statistics"),
                [
                    {
                        data: ordersLine,
                        lines: {
                            fill: 0.6,
                            lineWidth: 0,
                        },
                        color: ['#f89f9f']
                    }, {
                        data: ordersLine,
                        points: {
                            show: true,
                            fill: true,
                            radius: 5,
                            fillColor: "#f89f9f",
                            lineWidth: 3
                        },
                        color: '#fff',
                        shadowSize: 0
                    }
                ],
                {
                    xaxis: {
                        tickLength: 0,
                        tickDecimals: 0,
                        mode: "categories",
                        min: 0,
                        font: {
                            lineHeight: 14,
                            style: "normal",
                            variant: "small-caps",
                            color: "#6F7B8A"
                        }
                    },
                    yaxis: {
                        ticks: 5,
                        tickDecimals: 0,
                        tickColor: "#eee",
                        font: {
                            lineHeight: 14,
                            style: "normal",
                            variant: "small-caps",
                            color: "#6F7B8A"
                        }
                    },
                    grid: {
                        hoverable: true,
                        clickable: true,
                        tickColor: "#eee",
                        borderColor: "#eee",
                        borderWidth: 1
                    }
                });

                var previousPoint = null;
                $("#site_statistics")
                    .bind("plothover",
                        function(event, pos, item) {
                            $("#x").text(pos.x.toFixed(2));
                            $("#y").text(pos.y.toFixed(2));
                            if (item) {
                                if (previousPoint != item.dataIndex) {
                                    previousPoint = item.dataIndex;

                                    $("#tooltip").remove();
                                    var x = item.datapoint[0].toFixed(2),
                                        y = item.datapoint[1].toFixed(2);

                                    showChartTooltip(item.pageX,
                                        item.pageY,
                                        item.datapoint[0],
                                        item.datapoint[1] + ' 个订单');
                                }
                            } else {
                                $("#tooltip").remove();
                                previousPoint = null;
                            }
                        });
            }
        }

        function loadSalesLine(data1) {
            if ($('#sale_statistics').size() != 0) {
                //site activities
                var previousPoint2 = null;
                $('#sale_statistics_loading').hide();
                $('#sale_statistics_content').show();



                var plot_statistics = $.plot($("#sale_statistics"),

                    [{
                        data: data1,
                        lines: {
                            fill: 0.2,
                            lineWidth: 0,
                        },
                        color: ['#BAD9F5']
                    }, {
                        data: data1,
                        points: {
                            show: true,
                            fill: true,
                            radius: 4,
                            fillColor: "#9ACAE6",
                            lineWidth: 2
                        },
                        color: '#9ACAE6',
                        shadowSize: 1
                    }, {
                        data: data1,
                        lines: {
                            show: true,
                            fill: false,
                            lineWidth: 3
                        },
                        color: '#9ACAE6',
                        shadowSize: 0
                    }
                    ],

                    {

                        xaxis: {
                            tickLength: 0,
                            tickDecimals: 0,
                            mode: "categories",
                            min: 0,
                            font: {
                                lineHeight: 18,
                                style: "normal",
                                variant: "small-caps",
                                color: "#6F7B8A"
                            }
                        },
                        yaxis: {
                            ticks: 5,
                            tickDecimals: 0,
                            tickColor: "#eee",
                            font: {
                                lineHeight: 14,
                                style: "normal",
                                variant: "small-caps",
                                color: "#6F7B8A"
                            }
                        },
                        grid: {
                            hoverable: true,
                            clickable: true,
                            tickColor: "#eee",
                            borderColor: "#eee",
                            borderWidth: 1
                        }
                    });

                $("#sale_statistics").bind("plothover", function (event, pos, item) {
                    $("#x").text(pos.x.toFixed(2));
                    $("#y").text(pos.y.toFixed(2));
                    if (item) {
                        if (previousPoint2 != item.dataIndex) {
                            previousPoint2 = item.dataIndex;
                            $("#tooltip").remove();
                            var x = item.datapoint[0].toFixed(2),
                                y = item.datapoint[1].toFixed(2);
                            showChartTooltip(item.pageX, item.pageY, item.datapoint[0], item.datapoint[1] + '元');
                        }
                    }
                });

                $('#sale_statistics').bind("mouseleave", function () {
                    $("#tooltip").remove();
                });
            }
        }

        function showChartTooltip(x, y, xValue, yValue) {
            $('<div id="tooltip" class="chart-tooltip">' + yValue + '<\/div>').css({
                position: 'absolute',
                display: 'none',
                top: y - 40,
                left: x - 40,
                border: '0px solid #ccc',
                padding: '2px 6px',
                'background-color': '#fff',
            }).appendTo("body").fadeIn(200);
        }

    </script>
    <!-- END PAGE LEVEL SCRIPTS -->
}
