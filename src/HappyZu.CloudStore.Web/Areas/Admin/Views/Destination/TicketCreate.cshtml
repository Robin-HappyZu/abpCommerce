@using Abp.Json
@model HappyZu.CloudStore.Web.Areas.Admin.Models.EditTicketViewModel

@{
    ViewBag.Title = "添加景点门票";
}

<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="@Url.Action("Index", "Dashboard",new {area="Admin"},true)">控制面板</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="@Url.Action("Index", "Destination",new {area="Admin"},true)">景点管理</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="@Url.Action("DestEdit", "Destination",new {area="Admin",Id=Model.Dest.Id},true)">@(Model.Dest.Title)</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <span>@ViewBag.Title</span>
        </li>
    </ul>
</div>
<!-- END PAGE BAR -->
<!-- BEGIN PAGE TITLE-->
<div class="row">
    <div class="col-md-12 col-sm-12">
        <div class="zone zone-content">
            <div class="portlet solid portlet-box">
                <div class="portlet-title">
                    <div class="caption">
                        @ViewBag.Title
                    </div>
                    <div class="actions content-edit-box-actions">
                        <button type="submit" name="save" class="btn blue" data-loading-text="正在保存..." data-bind="click:submit">
                            <i class="fa fa-floppy-o"></i>
                            保存
                        </button>
                        <button type="submit" name="save-continue" class="btn blue">
                            <i class="fa fa-floppy-o"></i>
                            保存并继续编辑
                        </button>
                    </div>
                </div>
                <div class="portlet-body">
                    @using (Html.BeginForm("CityCreate", "Destination", FormMethod.Post, new { id = "uiform" }))
                    {
                        @Html.Partial("_TicketCreateOrEdit", Model)
                    }
                </div>
            </div>

        </div>
    </div>
</div>
<div class="clearfix">
</div>
@section style_plugins{
    <link href="~/Areas/Admin/content/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css" rel="stylesheet" />
    <link href="~/Areas/Admin/content/global/plugins/bootstrap-daterangepicker/daterangepicker.min.css" rel="stylesheet" />
    <link href="~/Areas/Admin/content/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css" rel="stylesheet" />
    <link href="~/Areas/Admin/content/global/plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css" rel="stylesheet" />
    <link href="~/Areas/Admin/content/global/plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" />
}
@section script_plugins{
    <script src="~/Areas/Admin/content/global/plugins/moment.min.js"></script>
    <script src="~/Areas/Admin/content/global/plugins/bootstrap-daterangepicker/daterangepicker.min.js"></script>
    <script src="~/Areas/Admin/content/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="~/Areas/Admin/content/global/plugins/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>
    <script src="~/Areas/Admin/content/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js"></script>
    <script src="~/Areas/Admin/content/global/plugins/bootstrap-modal/js/bootstrap-modal.js"></script>
    <script src="~/Areas/Admin/content/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>
}


@section scripts{
    <script>
        $(function () {
            if (jQuery().datepicker) {
                $('#pricedaterange').daterangepicker({
                    "locale": {
                        "format": "MM/DD/YYYY",
                        "separator": " - ",
                        "applyLabel": "确认",
                        "cancelLabel": "取消",
                        "fromLabel": "From",
                        "toLabel": "To",
                        "customRangeLabel": "Custom",
                        "weekLabel": "W",
                        "daysOfWeek": [
                            "日","一","二","三","四","五","六"
                        ],
                        "monthNames": [
                            "一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"
                        ],
                        "firstDay": 1
                    },
                    opens: (App.isRTL() ? 'right' : 'left'),
                    format: 'YYYY-MM-DD',
                    separator: ' 至 ',
                    minDate: moment(),
                    maxDate: moment().add(6, 'months').format('L')
                    
                },
                showPriceDateRange);
            };

            if (jQuery().timepicker) {
                
                $('.advanced-time-picker').timepicker({
                    minuteStep: 1,
                    template: false,
                    appendWidgetTo: 'body',
                    showMeridian: false,
                    defaultTime: '8:00'
                });
            }
        });

        function showPriceDateRange(start, end) {
            $('#pricedaterange input').val(start.format('YYYY-MM-DD') + ' 至 ' + end.format('YYYY-MM-DD'));
        }

        var ViewModel = function(name, returnUrl) {
            var _this = this;
            this.Name = ko.observable(name);
            this.ReturnUrl = ko.observable(returnUrl);

            this.submit = function(data, event) {
                var url = $('#uiform').attr("action");
                var params = [];
                @*params.push({ name: "@Html.NameFor(m=>m.City.Name)", value: _this.Name() });
                params.push({ name: "@Html.NameFor(m=>m.City.ProvinceId)", value: '@Model.ProvinceId' });
                params.push({ name: "@Html.NameFor(m=>m.ProvinceId)", value: '@Model.ProvinceId' });*@
                App.startPageLoading({animate: true});
                var $btn=$(event.target);
                $btn.button("loading");
                $.post(url, params, function(data) {
                    if (data.success) {
                        window.location = _this.ReturnUrl();
                        return;
                    } else {
                        App.alert({
                            container: '',
                            place: 'append', // append or prepent in container
                            type: 'danger',  // alert's type
                            message: data.error.message,  // alert's message
                            close: true, // make alert closable
                            reset: true, // close all previouse alerts first
                            focus: true, // auto scroll to the alert after shown
                            icon: 'warning' // put icon before the message
                        });
                    };
                    $btn.button('reset');
                    App.stopPageLoading();
                }, 'json');

            }
        };

        @*var vm = new ViewModel("@Model.City.Name",  "@Request["ReturnUrl"]");

        ko.applyBindings(vm);*@


    </script>
}