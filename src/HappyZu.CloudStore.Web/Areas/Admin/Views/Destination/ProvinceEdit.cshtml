

@using Abp.Json
@model HappyZu.CloudStore.Trip.Dto.UpdateDestProvinceInput
@{
    ViewBag.Title = "添加省份或地区";
}

<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="@Url.Action("Index", "Dashboard",new {area="Admin"},true)">控制面板</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="@Url.Action("Index", "Destination",new {area="Admin"},true)">帮助列表</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <span>@ViewBag.Title</span>
        </li>
    </ul>
</div>
<!-- END PAGE BAR -->
<!-- BEGIN PAGE TITLE-->
<h3 class="page-title">
    @ViewBag.Title
    <small>新的省份或地区</small>
</h3>


<div class="row">
    <div class="col-md-12 col-sm-12">
        <div class="zone zone-content">
            @using (Html.BeginForm("ProvinceEdit", "Destination", FormMethod.Post, new { id = "uiform" }))
            {
                @Html.Partial("_ProvinceCreateOrEdit", Model.Province)
            }
        </div>
    </div>
</div>
<div class="clearfix">
</div>

@section scripts{
    <script>

        var ViewModel = function(title, destType,returnUrl) {
            var _this = this;
            this.Name = ko.observable(title);
            this.DestType = ko.observable(destType);
            this.ReturnUrl = ko.observable(returnUrl);

            this.submit = function(data, event) {
                var url = $('#uiform').attr("action");
                var params = [];
                params.push({ name: "@Html.NameFor(m=>m.Province.Name)", value: _this.Name() });
                params.push({ name: "@Html.NameFor(m=>m.Province.DestType)", value: _this.DestType() });
                App.startPageLoading({animate: true});
                var $btn=$(event.target);
                $btn.button("loading");
                $.post(url, params, function(data) {
                    App.stopPageLoading();
                    $btn.button('reset');
                    if (data.success) {
                        window.location = _this.ReturnUrl();
                    } else {
                        App.alert({
                            container: '',
                            place: 'append', // append or prepent in container
                            type: 'danger',  // alert's type
                            message: data.error.message,  // alert's message
                            close: true, // make alert closable
                            reset: true, // close all previouse alerts first
                            focus: true, // auto scroll to the alert after shown
                            icon: 'warning' // put icon before the message
                        });
                    }
                }, 'json');

            }
        };

        var vm = new ViewModel("@Model.Province.Name", @((int)Model.Province.DestType), "@Request["ReturnUrl"]");

        ko.applyBindings(vm);


    </script>
}